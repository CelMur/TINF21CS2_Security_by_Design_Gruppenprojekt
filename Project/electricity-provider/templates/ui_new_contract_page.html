{%  extends "base.html" %}

{% block titel %}
Login
{% endblock %}


{% block header_logged_in %}

{% load static %}
<link rel="stylesheet" href="{% static 'css/custom.css' %}">

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="/">
      <img src="https://www.pngall.com/wp-content/uploads/2016/07/Sun-PNG-Clipart.png" alt="Logo" class="logo" style="width: 50px;">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/pricing/">Pricing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/customer/">My Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/profile/">My Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout/">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}


{% block body %}

<div class="container">
  <div class="card" style="margin-top: 20px; margin-bottom: 20px;">
    <div class="card-header" style="text-align: center;">
      <h3>Neuen Vertrag anlegen</h3>
    </div>
  
    <div class="card card-body" style="padding: 10px;">
      <form id="new_contract_form" method="POST" action="http://localhost:8000/api/v1/contract/">
        {% csrf_token %}

        <div class="row align-items-start" style="border-bottom: 2px solid #DFDFDF;">
          <div class="col" style="margin-left: 100px;">
              <label for="first_name" class="mt-md mb-md fixed-height">Vorname:</label><br>
              <label for="last_name" class="mb-md fixed-height">Nachname:</label><br>
              <label for="tariff" class="mb-md fixed-height">Tarif:</label>
          </div>
      
          <div class="col">
              <input type="text" id="first_name" name="first_name" class="mt-md mb-md w-100 fixed-height">
              <input type="text" id="last_name" name="last_name" class="mb-md w-100 fixed-height">
              <select id="tariff" name="tariff" class="form-select mb-md w-100" aria-label="Default select example">
                  <option selected>Tarif auswählen</option>
                  {% for tariff in tariffs%}
                    <option value="{{ tariff.id }}">{{ tariff.name }} ({{ tariff.price_in_euro}} Euro/Kwh)</option>
                  {% endfor %}
              </select>
          </div>
        </div>

        <div class="row align-items-start mt-md" style="border-bottom: 2px solid #DFDFDF;">
          <div class="col-12" style="margin-left: 80px;">
            <h5>Sendeadresse</h5>
          </div>
          <div class="col" style="margin-left: 100px;">
            <label for="street" class="mb-md fixed-height">Straße/</label>
            <label for="street_number" class="mb-md fixed-height">Hausnummer:</label><br>
            <label for="postal_code" class="mb-md fixed-height">Postleitzahl/</label>
            <label for="city" class="mb-md fixed-height">Stadt:</label><br>
          </div>

          <div class="col">
            <!-- Sendeadresse -->
            <div class="input-group">
              <input type="text" id="street" name="street" class="form-control mb-md fixed-height" style="width: 70%; outline: none; border: 1px solid black; border-radius: 0;">
              <input type="text" id="street_number" name="street_number" class="form-control mb-md fixed-height" style="outline: none; border: 1px solid black; border-radius: 0;">
            </div>
            
            <div class="input-group"> 
              <input type="text" id="postal_code" name="postal_code" class="mb-md form-control fixed-height" style="outline: none; border: 1px solid black; border-radius: 0;">
              <input type="text" id="city" name="city" class="mb-md form-control fixed-height" style="width: 50%; outline: none; border: 1px solid black; border-radius: 0;">
            </div>
          </div>
        </div>

        <div class="row align-items-start mt-md" style="border-bottom: 2px solid #DFDFDF;">
          <div class="col-12" style="margin-left: 80px;">
            <h5>Rechnungsadresse</h5>
          </div>
          <div class="col" style="margin-left: 100px;">
            <label for="billing_street" class="mb-md fixed-height">Straße/</label>
            <label for="billing_street_number" class="mb-md fixed-height">Hausnummer:</label><br>
            <label for="billing_postal_code" class="mb-md fixed-height">Postleitzahl/</label>
            <label for="billing_city" class="mb-md fixed-height">Stadt:</label><br>
          </div>

          <div class="col">
            <!-- Rechnungsadresse -->
            <div class="input-group">
              <input type="text" id="billing_street" name="billing_street" class="form-control mb-md fixed-height" style="width: 70%; outline: none; border: 1px solid black; border-radius: 0;">
              <input type="text" id="billing_street_number" name="billing_street_number" class="form-control mb-md fixed-height" style="outline: none; border: 1px solid black; border-radius: 0;">
            </div>
            
            <div class="input-group"> 
              <input type="text" id="billing_postal_code" name="billing_postal_code" class="mb-md form-control fixed-height" style="outline: none; border: 1px solid black; border-radius: 0;">
              <input type="text" id="billing_city" name="billing_city" class="mb-md form-control fixed-height" style="width: 50%; outline: none; border: 1px solid black; border-radius: 0;">
            </div>
          </div>
        </div>

        <div class="row align-items-start mt-md" style="border-bottom: 2px solid #DFDFDF;">
          <div class="col-12" style="margin-left: 80px;">
            <h5>Bankdaten</h5>
          </div>

          <div class="col" style="margin-left: 100px;">
            <label for="account_owner" class="mb-md fixed-height">Kontoinhaber:</label><br>
            <label for="iban" class="mb-md fixed-height">IBAN:</label><br>
            <label for="bic" class="mb-md fixed-height">BIC:</label><br>
          </div>

          <div class="col">
            <!-- Bankdaten -->
            <input type="text" id="account_owner" name="account_owner" class="mb-md w-100"><br>
            <input type="text" id="iban" name="iban" class="mb-md w-100"><br>
            <input type="text" id="bic" name="bic" class="mb-md w-100"><br>
          </div>
        </div>

        <div class="d-flex justify-content-center" style="margin-top: 20px; margin-bottom: 20px;">
          <input type="submit" value="Vertrag anlegen">
        </div>

      </form>
        
    </div>
</div>

<script>
  $(document).ready(function () {
      $('#new_contract_form').on('submit', function(event){
          event.preventDefault();
          $.ajax({
              type: 'POST',
              url: $(this).attr('action'),
              data: JSON.stringify({
                  first_name: $('#first_name').val(),
                  last_name: $('#last_name').val(),
                  tariff: $('#tariff').val(),

                  address: {
                      street: $('#street').val(),
                      street_number: $('#street_number').val(),
                      postal_code: $('#postal_code').val(),
                      city: $('#city').val(),
                  },

                  billing_address: {
                      street: $('#billing_street').val(),
                      street_number: $('#billing_street_number').val(),
                      postal_code: $('#billing_postal_code').val(),
                      city: $('#billing_city').val(),
                  },
                  
                  bank_account: {
                      account_owner: $('#account_owner').val(),
                      iban: $('#iban').val(),
                      bic: $('#bic').val(),
                  },
              }),
              contentType: 'application/json',
              dataType: 'json',
              success: function(data) {
                  // Redirect to the /customer page after successful login
                  window.location.href = "/contract";
              },
              error: function(jqXHR, textStatus, errorThrown) {
                  // Display an error message
                  alert('Failed to create contract: ' + errorThrown);
              }
          });
      });
  });
</script>

{% endblock %}