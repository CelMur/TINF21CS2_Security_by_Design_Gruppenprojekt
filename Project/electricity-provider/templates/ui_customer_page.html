{%  extends "base.html" %}

{% block titel %}
Dashboard
{% endblock %}


{% block header_logged_in %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="https://www.pngall.com/wp-content/uploads/2016/07/Sun-PNG-Clipart.png" alt="Logo" class="logo" style="width: 50px;">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/pricing/">Pricing</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/contract/">Contract</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/profile/">My Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/logout/">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
{% endblock %}


{% block body %}

<div class="container" style="margin-top: 20px;">
    <div class="row">
        <div class="col align">
            <div class="card">
                <div class="card-header d-flex justify-content-between" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                    <div>Zähler xx</div>
                    <!-- hier muss die Anzeige hin welchen Status der Zähler hat -->
                    <div>last_reading</div>
                    <div>last_reading_date</div>
                </div>

                <div class="collapse" id="collapseExample">
                    <div class="card-body">

                        <!-- Erstes Diagramm: Montasansicht -->
                        <canvas id="myLineChart1" style="width:100%; height: 100px;"></canvas>
                        <script>

                            const values = {{ messwerte|safe }}

                            var ctx1 = document.getElementById('myLineChart1').getContext('2d');
                            var myLineChart1 = new Chart(ctx1, {
                                type: 'line',
                                data: {
                                    labels: values.map(messwert => {
                                        let date = new Date(messwert.timestamp);
                                        return date.toLocaleDateString('de-DE') + ' - ' + date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                                    }),                                                             
                                    datasets: [{
                                        label: 'Stromverbrauch in kW/h',
                                        data: values.map(messwert => messwert.value),
                                        borderColor: 'rgba(175, 235, 173)',
                                        backgroundColor: 'rgba(175, 235, 173, 0.5)',
                                        fill: true
                                    }]
                                },
                                options: {
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Monatsansicht',
                                            position: 'top',
                                            font: {
                                                size: 20, 
                                            },
                                        },
                                    },
                                    responsive: true,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                stepSize: 200,
                                                min: 0,
                                                max: 18
                                            }
                                        }
                                    },  
                                }
                            });
                        </script>

                        <!-- Zweites Diagramm -->
                        <canvas id="myLineChart2" style="width:100%; height: 100px;"></canvas>
                        <script>
                            var ctx2 = document.getElementById('myLineChart2').getContext('2d');
                            var myLineChart2 = new Chart(ctx2, {
                                type: 'line',
                                data: {
                                    labels: values.map(messwert => {
                                        let date = new Date(messwert.timestamp);
                                        return date.toLocaleDateString('de-DE') + ' - ' + date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                                    }),                                                             
                                    datasets: [{
                                        label: 'Stromverbrauch in kW/h',
                                        data: values.map(messwert => messwert.value),
                                        borderColor: 'rgba(175, 235, 173)',
                                        backgroundColor: 'rgba(175, 235, 173, 0.5)',
                                        fill: true
                                    }]
                                },
                                options: {
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Tagesansicht',
                                            position: 'top',
                                            font: {
                                                size: 20, 
                                            },
                                        },
                                    },
                                    responsive: true,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                stepSize: 200,
                                                min: 0,
                                                max: 18
                                            }
                                        }
                                    },  
                                }
                            });
                        </script>
                        
                    </div>
                </div>

            </div>
        </div>
    </div>
    
</div>


{% endblock %}